@namespace NoLock.Social.Components.Camera
@using NoLock.Social.Core.Camera.Interfaces
@using NoLock.Social.Core.Camera.Models

<div class="camera-permission-container">
    <div class="card">
        <div class="card-body text-center">
            <h5 class="card-title">Camera Access Required</h5>
            <p class="card-text">
                This app needs access to your camera to scan QR codes and capture photos for your social feed.
            </p>
            
            <button class="btn btn-primary mb-3" @onclick="RequestCameraPermission" disabled="@IsRequestInProgress">
                <i class="bi bi-camera"></i> Grant Camera Access
            </button>
            
            <div class="permission-status">
                <small class="text-muted">
                    Current Status: <span class="fw-bold">@GetPermissionStatusText()</span>
                </small>
            </div>
        </div>
    </div>
</div>

@code {
    [Inject] private ICameraService CameraService { get; set; } = null!;
    
    private CameraPermissionState _currentState = CameraPermissionState.NotRequested;
    private bool IsRequestInProgress { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        // Check current permission state on component load
        _currentState = await CameraService.GetPermissionStateAsync();
    }
    
    private async Task RequestCameraPermission()
    {
        IsRequestInProgress = true;
        StateHasChanged();
        
        try
        {
            _currentState = await CameraService.RequestPermissionAsync();
        }
        finally
        {
            IsRequestInProgress = false;
            StateHasChanged();
        }
    }
    
    private string GetPermissionStatusText()
    {
        return _currentState switch
        {
            CameraPermissionState.NotRequested => "Not Requested",
            CameraPermissionState.Granted => "Granted",
            CameraPermissionState.Denied => "Denied",
            CameraPermissionState.Prompt => "Awaiting Response",
            _ => "Unknown"
        };
    }
}